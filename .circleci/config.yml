version: 2
jobs:
  build:
    working_directory: ~/cocktalesapi
    machine:
      image: circleci/classic:201711-01
    steps:
      - checkout
      - run:
          name: Build Release Image
          command: |
            docker-compose -f docker-compose.yml up -d --build
            if [ "${CIRCLE_BRANCH}" == "master" ]; then
              scp docker-compose.yml openapi.yaml root@${STAGING_SERVER}:~/api-staging
              ssh root@${STAGING_SERVER} "docker-compose -f ~/api-staging/docker-compose.yml up -d --build"
            fi

